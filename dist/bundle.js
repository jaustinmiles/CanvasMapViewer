(()=>{"use strict";function t(t,e,r){const o=t.getBoundingClientRect();return{x:e=(e-o.left-t.width/2)/(t.width/2),y:r=(t.height/2-(r-o.top))/(t.height/2)}}function e(t){const e=new Float32Array(3*t.length);for(let r=0;r<t.length;r++)e[3*r]=t[r][0],e[3*r+1]=t[r][1],e[3*r+2]=t[r][2];return e}function r(t,e){return{x:t.x+e.x,y:t.y+e.y}}function o(t,e){return{x:t.x-e.x,y:t.y-e.y}}let n=0,i=0;var s,a;!function(t){t.u_Sampler="u_Sampler",t.u_Transform="u_Transform"}(s||(s={})),function(t){t.a_Position="a_Position",t.a_TexCoord="a_TexCoord"}(a||(a={}));function l(e,n){const i=u(n,"#version 100\n\nattribute vec4 a_Position;\nattribute vec2 a_TexCoord;\nuniform mat4 u_Transform;\nvarying vec2 v_TexCoord;\nvoid main() {\n    gl_Position = u_Transform * a_Position;\n    v_TexCoord = a_TexCoord;\n}","#version 100\n\nprecision mediump float;\nuniform sampler2D u_Sampler;\nvarying vec2 v_TexCoord;\nvoid main() {\n    gl_FragColor = texture2D(u_Sampler, v_TexCoord);\n}");return null==i?(console.log("failed to initialize shaders"),null):new class{constructor(t,e){this.textures=new Array,this.dirty=!1,this.transform=new Float32Array,this.texIndex=0,this.attributes={a_Position:-1,a_TexCoord:-1},this.uniforms={u_Sampler:null,u_Transform:null},this.coords=new Float32Array([-1,1,0,1,-1,-1,0,0,1,1,1,1,1,-1,1,0]),this.n=4,this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.coords,t.STATIC_DRAW);const r=this.coords.BYTES_PER_ELEMENT;this.attributes.a_Position=t.getAttribLocation(e,a.a_Position),this.attributes.a_TexCoord=t.getAttribLocation(e,a.a_TexCoord),this.uniforms.u_Transform=t.getUniformLocation(e,s.u_Transform),this.uniforms.u_Sampler=t.getUniformLocation(e,s.u_Sampler),console.log(this.attributes),t.vertexAttribPointer(this.attributes.a_Position,2,t.FLOAT,!1,4*r,0),t.enableVertexAttribArray(this.attributes.a_Position),t.vertexAttribPointer(this.attributes.a_TexCoord,2,t.FLOAT,!1,4*r,2*r),t.enableVertexAttribArray(this.attributes.a_TexCoord),this.textures.push(...this.initTextures(t,e)),this.program=e}initTextures(t,e){const r=t.createTexture(),o=t.createTexture();if(null==r||null==o)return console.log("Couldn't create webgl texture"),[];console.log(this.uniforms);const n=new Image;n.onload=()=>this.loadTexture(t,r,n,t.TEXTURE0,0),n.src="./images/map.jpg";const i=new Image;return i.onload=()=>this.loadTexture(t,o,i,t.TEXTURE1,1),i.src="./images/map2.jpg",[r,o]}swapTextures(t,e){this.texIndex=e,t.useProgram(this.program)}loadTexture(t,e,r,o,n){t.useProgram(this.program),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.activeTexture(o),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,r),t.uniform1i(this.uniforms.u_Sampler,n),t.drawArrays(t.TRIANGLE_STRIP,0,this.n),console.log("loaded")}draw(t,e){t.useProgram(this.program),t.uniformMatrix4fv(this.uniforms.u_Transform,!1,e),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),this.dirty&&t.bufferData(t.ARRAY_BUFFER,this.coords,t.STATIC_DRAW),t.bindTexture(t.TEXTURE_2D,this.textures[this.texIndex]);const r=this.coords.BYTES_PER_ELEMENT;t.vertexAttribPointer(this.attributes.a_Position,2,t.FLOAT,!1,4*r,0),t.enableVertexAttribArray(this.attributes.a_Position),t.vertexAttribPointer(this.attributes.a_TexCoord,2,t.FLOAT,!1,4*r,2*r),t.enableVertexAttribArray(this.attributes.a_TexCoord),t.drawArrays(t.TRIANGLE_STRIP,0,this.n)}dilate(e,n,i,s){let a=t(e,n,i);for(let t=0;t<this.coords.length;t++){console.log(this.coords.length),console.log(t);let e={x:this.coords[4*t],y:this.coords[4*t+1]};e=o(e,a),e.x*=s,e.y*=s,e=r(e,a),this.coords[4*t]=e.x,this.coords[4*t+1]=e.y}console.log(this.coords),this.dirty=!0}}(n,i)}function u(t,e,r){const o=function(t,e,r){const o=c(t,t.VERTEX_SHADER,e),n=c(t,t.FRAGMENT_SHADER,r);if(!o||!n)return null;const i=t.createProgram();if(!i)return null;if(t.attachShader(i,o),t.attachShader(i,n),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const e=t.getProgramInfoLog(i);return console.log("Failed to link program, reason: "+e),t.deleteProgram(i),t.deleteShader(n),t.deleteShader(o),null}return i}(t,e,r);return o?(t.useProgram(o),o):(console.log("Failed to create program"),null)}function c(t,e,r){const o=t.createShader(e);if(null==o)return console.log("failed to create shader"),null;if(t.shaderSource(o,r),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(o);return console.log("Failed to compile shader, reason: "+e),t.deleteShader(o),null}return o}!function(){const s=document.createElement("canvas");s.height=window.innerHeight,s.width=window.innerWidth,document.body.appendChild(s);const a=s.getContext("webgl");if(!a)return void console.log("no webgl context available");a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT);const c=l(0,a),h=function(n,i){const s=u(i,"attribute vec4 a_Position;\nattribute float a_PointSize;\nuniform mat4 u_Transform;\nvoid main() {\n    gl_Position = u_Transform * a_Position;\n    gl_PointSize = a_PointSize;\n}","precision mediump float;\n\nuniform vec4 u_FragColor;\nvoid main() {\n    gl_FragColor = u_FragColor;\n}");if(null==s)return console.log("failed to initialize shaders"),null;const a=new class{constructor(t){this.transform=new Float32Array,this.dirty=!1,this.gl_Points=new Array,this.gl_Colors=new Array,this.shapeIndices=new Array,this.shapeIndices.push(0),this.shapeIndices.push(0),this.angle=0,this.translation={x:0,y:0},this.translationScale=.005,this.attributes={a_Position:-1,u_FragColor:null,a_PointSize:-1},this.program=t,this.vertexBuffer=null}click(e,r,o){let n=e.clientX,i=e.clientY,s=t(o,n,i);s=this.getInv(s),this.gl_Points.push(new Array(...[s.x,s.y,0]));const a=Math.sqrt(n*n+i*i);this.gl_Colors.push(new Array(...[a,1-a,a,1])),this.renderBuffer(r)}renderBuffer(t){t.useProgram(this.program),this.dirty&&this.setTransformUniform(t,this.program),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.vertexAttribPointer(this.attributes.a_Position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.attributes.a_Position),t.lineWidth(5),this.setBuffer(t);const e=this.shapeIndices;for(let r=1;r<e.length;r++)t.drawArrays(t.LINE_STRIP,e[r-1],e[r]-e[r-1])}setBuffer(t){t.bufferData(t.ARRAY_BUFFER,e(this.gl_Points),t.STATIC_DRAW)}transformAndRender(t,e){this.setTransformUniform(t,e),this.renderBuffer(t)}setTransformUniform(t,e){const r=t.getUniformLocation(e,"u_Transform");if(null==r)return void console.log("Couldn't set uniforms for transformations");const o=Math.sin(this.angle),n=Math.cos(this.angle);this.transform=new Float32Array([n,o,0,0,-o,n,0,0,0,0,1,0,this.translation.x,this.translation.y,0,1]),t.uniformMatrix4fv(r,!1,this.transform)}getInv(t){const e=Math.sin(-this.angle),r=Math.cos(-this.angle);return function(t,e){return{x:t[0]*e.x+t[4]*e.y+t[12],y:t[1]*e.x+t[5]*e.y+t[13]}}(new Float32Array([r,e,0,0,-e,r,0,0,0,0,1,0,-this.translation.x,-this.translation.y,0,1]),t)}dilate(e,n,i,s){let a=t(e,n,i),l=this.gl_Points;a=o(a,this.translation);for(let t=0;t<l.length;t++){let e=l[t],n={x:e[0],y:e[1]};n=o(n,a),n.x*=s,n.y*=s,n=r(n,a),l[t][0]=n.x,l[t][1]=n.y}}initVertexBuffers(t,r){const o=this.gl_Points.length/2;return this.vertexBuffer=t.createBuffer(),this.vertexBuffer?(t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e(this.gl_Points),t.STATIC_DRAW),this.attributes.a_Position=t.getAttribLocation(r,"a_Position"),t.vertexAttribPointer(this.attributes.a_Position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.attributes.a_Position),o):(console.log("failed to create buffer"),-1)}}(s),l=i.getAttribLocation(s,"a_Position");if(l<0)return console.log("failed to get the storage location of a_Position"),null;const c=i.getAttribLocation(s,"a_PointSize");if(c<0)return console.log("failed to get the storage location of a_PointSize"),null;const h=i.getUniformLocation(s,"u_FragColor");if(null==h)return console.log("failed to get uniform u_fragColor"),null;a.attributes.a_Position=l,a.attributes.u_FragColor=h,a.attributes.a_PointSize=c,i.vertexAttrib1f(c,20),a.setTransformUniform(i,s);const f=a.initVertexBuffers(i,s);return i.drawArrays(i.POINTS,0,f),a}(0,a);if(null==c||null==h)return void console.log("failed to initialize objects");!function(t,e,o,s){function a(t,e,r){o.angle+=r,o.transformAndRender(t,e)}t.onmousedown=r=>{0==r.button?(n++,o.click(r,e,t)):2==r.button&&i++},window.oncontextmenu=t=>(t.preventDefault(),!1),t.onmouseup=t=>{0==t.button?(o.shapeIndices.push(o.gl_Points.length),n--):2==t.button&&i--},t.onmousemove=s=>{const a=o.shapeIndices;if(n>0)o.click(s,e,t),a[a.length-1]=o.gl_Points.length;else if(i>0){const t=s.movementX,n=s.movementY;o.translation=r(o.translation,{x:t*o.translationScale,y:-n*o.translationScale}),o.transformAndRender(e,o.program)}},window.onkeydown=t=>{switch(console.log(t.code),t.code){case"KeyQ":a(e,o.program,.1);break;case"KeyE":a(e,o.program,-.1);break;case"Digit1":s.swapTextures(e,0);break;case"Digit2":s.swapTextures(e,1)}},t.onwheel=r=>{const n=r.deltaY<0?1.1:.9;o.dilate(t,r.clientX,r.clientY,n),s.dilate(t,r.clientX,r.clientY,n),o.renderBuffer(e)}}(s,a,h,c);const f=()=>{a.clear(a.COLOR_BUFFER_BIT),null==c||c.draw(a,h.transform),null==h||h.renderBuffer(a),requestAnimationFrame(f)};f()}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxJQUNyQyxNQUNKLElBQUssU0FDRGtDLEVBQVFXLGFBQWE5QyxFQUFJLEdBQ3pCLE1BQ0osSUFBSyxTQUNEbUMsRUFBUVcsYUFBYTlDLEVBQUksR0FFakMsRUFFSnhCLEVBQU9zTCxRQUFVdEMsSUFDYixNQUFNdUMsRUFBV3ZDLEVBQU1rQyxPQUFTLEVBQUksSUFBTSxHQUMxQzdDLEVBQVF4QyxPQUFPN0YsRUFBUWdKLEVBQU1DLFFBQVNELEVBQU1FLFFBQVNxQyxHQUNyRDVILEVBQVFrQyxPQUFPN0YsRUFBUWdKLEVBQU1DLFFBQVNELEVBQU1FLFFBQVNxQyxHQUNyRGxELEVBQVFtQixhQUFhaEksRUFBRyxDQU1oQyxDRXpDSSxDQUFjeEIsRUFBUXdCLEVBQUk2RyxFQUFTMUUsR0FDbkMsTUFBTTZILEVBQVMsS0FDWGhLLEVBQUcyRyxNQUFNM0csRUFBRzRHLGtCQUNaekUsU0FBa0RBLEVBQVFnQyxLQUFLbkUsRUFBSTZHLEVBQVFuRyxXQUMzRW1HLFNBQWtEQSxFQUFRbUIsYUFBYWhJLEdBQ3ZFaUssc0JBQXNCRCxFQUFPLEVBRWpDQSxHQUNKLENBMEZBRSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViZ2xfYmFzaWNzLy4vc3JjL3dlYmdsX3V0aWxzLnRzIiwid2VicGFjazovL3dlYmdsX2Jhc2ljcy8uL3NyYy9pbnRlcmZhY2VzLnRzIiwid2VicGFjazovL3dlYmdsX2Jhc2ljcy8uL3NyYy9oYW5kbGVycy50cyIsIndlYnBhY2s6Ly93ZWJnbF9iYXNpY3MvLi9zcmMvdGV4dHVyZS50cyIsIndlYnBhY2s6Ly93ZWJnbF9iYXNpY3MvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vd2ViZ2xfYmFzaWNzLy4vc3JjL3NoYWRlcnMvdlRleHR1cmVkLmdsc2wiLCJ3ZWJwYWNrOi8vd2ViZ2xfYmFzaWNzLy4vc3JjL3NoYWRlcnMvZlRleHR1cmVkLmdsc2wiLCJ3ZWJwYWNrOi8vd2ViZ2xfYmFzaWNzLy4vc3JjL3NoYWRlcnMvdkhlbGxvUG9pbnQuZ2xzbCIsIndlYnBhY2s6Ly93ZWJnbF9iYXNpY3MvLi9zcmMvc2hhZGVycy9mSGVsbG9Qb2ludC5nbHNsIiwid2VicGFjazovL3dlYmdsX2Jhc2ljcy8uL3NyYy9kcmF3aW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGdsUG9zRnJvbUNsaWVudChjYW52YXMsIHgsIHkpIHtcbiAgICBjb25zdCByZWN0ID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHggPSAoKHggLSByZWN0LmxlZnQpIC0gY2FudmFzLndpZHRoIC8gMikgLyAoY2FudmFzLndpZHRoIC8gMik7XG4gICAgeSA9IChjYW52YXMuaGVpZ2h0IC8gMiAtICh5IC0gcmVjdC50b3ApKSAvIChjYW52YXMuaGVpZ2h0IC8gMik7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogeSxcbiAgICB9O1xufVxuZnVuY3Rpb24gdW5wYWNrKGFycmF5KSB7XG4gICAgY29uc3Qgb3V0ID0gbmV3IEZsb2F0MzJBcnJheShhcnJheS5sZW5ndGggKiAzKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG91dFtpICogM10gPSBhcnJheVtpXVswXTtcbiAgICAgICAgb3V0W2kgKiAzICsgMV0gPSBhcnJheVtpXVsxXTtcbiAgICAgICAgb3V0W2kgKiAzICsgMl0gPSBhcnJheVtpXVsyXTtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbn1cbmV4cG9ydCB7IGdsUG9zRnJvbUNsaWVudCwgdW5wYWNrIH07XG4iLCJmdW5jdGlvbiBhZGQodjEsIHYyKSB7XG4gICAgcmV0dXJuIHsgeDogdjEueCArIHYyLngsIHk6IHYxLnkgKyB2Mi55IH07XG59XG5mdW5jdGlvbiBzdWJ0cmFjdCh2MSwgdjIpIHtcbiAgICByZXR1cm4geyB4OiB2MS54IC0gdjIueCwgeTogdjEueSAtIHYyLnkgfTtcbn1cbmZ1bmN0aW9uIG11bHQobWF0LCB2KSB7XG4gICAgcmV0dXJuIHsgeDogbWF0WzBdICogdi54ICsgbWF0WzRdICogdi55ICsgbWF0WzEyXSwgeTogbWF0WzFdICogdi54ICsgbWF0WzVdICogdi55ICsgbWF0WzEzXSB9O1xufVxuZXhwb3J0IHsgYWRkLCBzdWJ0cmFjdCwgbXVsdCB9O1xuIiwiaW1wb3J0IHsgYWRkIH0gZnJvbSBcIi4vaW50ZXJmYWNlc1wiO1xubGV0IGxlZnRNb3VzZURvd24gPSAwO1xubGV0IHJpZ2h0TW91c2VEb3duID0gMDtcbmZ1bmN0aW9uIHNldHVwSGFuZGxlcnMoY2FudmFzLCBnbCwgZHJhd2luZywgdGV4dHVyZSkge1xuICAgIGNhbnZhcy5vbm1vdXNlZG93biA9IGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbiA9PSAwKSB7XG4gICAgICAgICAgICBsZWZ0TW91c2VEb3duKys7XG4gICAgICAgICAgICBkcmF3aW5nLmNsaWNrKGV2ZW50LCBnbCwgY2FudmFzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChldmVudC5idXR0b24gPT0gMikge1xuICAgICAgICAgICAgcmlnaHRNb3VzZURvd24rKztcbiAgICAgICAgfVxuICAgIH07XG4gICAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBldmVudCA9PiB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIGNhbnZhcy5vbm1vdXNldXAgPSBldmVudCA9PiB7XG4gICAgICAgIGlmIChldmVudC5idXR0b24gPT0gMCkge1xuICAgICAgICAgICAgZHJhd2luZy5zaGFwZUluZGljZXMucHVzaChkcmF3aW5nLmdsX1BvaW50cy5sZW5ndGgpO1xuICAgICAgICAgICAgbGVmdE1vdXNlRG93bi0tO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGV2ZW50LmJ1dHRvbiA9PSAyKSB7XG4gICAgICAgICAgICByaWdodE1vdXNlRG93bi0tO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjYW52YXMub25tb3VzZW1vdmUgPSBldmVudCA9PiB7XG4gICAgICAgIGNvbnN0IHNoYXBlSW5kaWNlcyA9IGRyYXdpbmcuc2hhcGVJbmRpY2VzO1xuICAgICAgICBpZiAobGVmdE1vdXNlRG93biA+IDApIHtcbiAgICAgICAgICAgIGRyYXdpbmcuY2xpY2soZXZlbnQsIGdsLCBjYW52YXMpO1xuICAgICAgICAgICAgc2hhcGVJbmRpY2VzW3NoYXBlSW5kaWNlcy5sZW5ndGggLSAxXSA9IGRyYXdpbmcuZ2xfUG9pbnRzLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyaWdodE1vdXNlRG93biA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhWCA9IGV2ZW50Lm1vdmVtZW50WDtcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhWSA9IGV2ZW50Lm1vdmVtZW50WTtcbiAgICAgICAgICAgIGRyYXdpbmcudHJhbnNsYXRpb24gPSBhZGQoZHJhd2luZy50cmFuc2xhdGlvbiwgeyB4OiBkZWx0YVggKiBkcmF3aW5nLnRyYW5zbGF0aW9uU2NhbGUsIHk6IC1kZWx0YVkgKiBkcmF3aW5nLnRyYW5zbGF0aW9uU2NhbGUgfSk7XG4gICAgICAgICAgICBkcmF3aW5nLnRyYW5zZm9ybUFuZFJlbmRlcihnbCwgZHJhd2luZy5wcm9ncmFtKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgd2luZG93Lm9ua2V5ZG93biA9IGV2ZW50ID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZXZlbnQuY29kZSk7XG4gICAgICAgIHN3aXRjaCAoZXZlbnQuY29kZSkge1xuICAgICAgICAgICAgY2FzZSBcIktleVFcIjpcbiAgICAgICAgICAgICAgICBjaGFuZ2VSb3RhdGlvbihnbCwgZHJhd2luZy5wcm9ncmFtLCAwLjEpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIktleUVcIjpcbiAgICAgICAgICAgICAgICBjaGFuZ2VSb3RhdGlvbihnbCwgZHJhd2luZy5wcm9ncmFtLCAtMC4xKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJEaWdpdDFcIjpcbiAgICAgICAgICAgICAgICB0ZXh0dXJlLnN3YXBUZXh0dXJlcyhnbCwgMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiRGlnaXQyXCI6XG4gICAgICAgICAgICAgICAgdGV4dHVyZS5zd2FwVGV4dHVyZXMoZ2wsIDEpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjYW52YXMub253aGVlbCA9IGV2ZW50ID0+IHtcbiAgICAgICAgY29uc3QgZGlsYXRpb24gPSBldmVudC5kZWx0YVkgPCAwID8gMS4xIDogMC45O1xuICAgICAgICBkcmF3aW5nLmRpbGF0ZShjYW52YXMsIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFksIGRpbGF0aW9uKTtcbiAgICAgICAgdGV4dHVyZS5kaWxhdGUoY2FudmFzLCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZLCBkaWxhdGlvbik7XG4gICAgICAgIGRyYXdpbmcucmVuZGVyQnVmZmVyKGdsKTtcbiAgICB9O1xuICAgIGZ1bmN0aW9uIGNoYW5nZVJvdGF0aW9uKGdsLCBwcm9ncmFtLCB2YWx1ZSkge1xuICAgICAgICBkcmF3aW5nLmFuZ2xlICs9IHZhbHVlO1xuICAgICAgICBkcmF3aW5nLnRyYW5zZm9ybUFuZFJlbmRlcihnbCwgcHJvZ3JhbSk7XG4gICAgfVxufVxuZXhwb3J0IGRlZmF1bHQgc2V0dXBIYW5kbGVycztcbiIsImltcG9ydCB7IGdsUG9zRnJvbUNsaWVudCB9IGZyb20gXCIuL3dlYmdsX3V0aWxzXCI7XG5pbXBvcnQgeyBhZGQsIHN1YnRyYWN0IH0gZnJvbSBcIi4vaW50ZXJmYWNlc1wiO1xudmFyIFVuaWZvcm1OYW1lcztcbihmdW5jdGlvbiAoVW5pZm9ybU5hbWVzKSB7XG4gICAgVW5pZm9ybU5hbWVzW1widV9TYW1wbGVyXCJdID0gXCJ1X1NhbXBsZXJcIjtcbiAgICBVbmlmb3JtTmFtZXNbXCJ1X1RyYW5zZm9ybVwiXSA9IFwidV9UcmFuc2Zvcm1cIjtcbn0pKFVuaWZvcm1OYW1lcyB8fCAoVW5pZm9ybU5hbWVzID0ge30pKTtcbnZhciBBdHRyaWJ1dGVOYW1lcztcbihmdW5jdGlvbiAoQXR0cmlidXRlTmFtZXMpIHtcbiAgICBBdHRyaWJ1dGVOYW1lc1tcImFfUG9zaXRpb25cIl0gPSBcImFfUG9zaXRpb25cIjtcbiAgICBBdHRyaWJ1dGVOYW1lc1tcImFfVGV4Q29vcmRcIl0gPSBcImFfVGV4Q29vcmRcIjtcbn0pKEF0dHJpYnV0ZU5hbWVzIHx8IChBdHRyaWJ1dGVOYW1lcyA9IHt9KSk7XG5jbGFzcyBUZXh0dXJlIHtcbiAgICBjb25zdHJ1Y3RvcihnbCwgcHJvZ3JhbSkge1xuICAgICAgICB0aGlzLnRleHR1cmVzID0gbmV3IEFycmF5KCk7XG4gICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy50cmFuc2Zvcm0gPSBuZXcgRmxvYXQzMkFycmF5KCk7XG4gICAgICAgIHRoaXMudGV4SW5kZXggPSAwO1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSB7IGFfUG9zaXRpb246IC0xLCBhX1RleENvb3JkOiAtMSB9O1xuICAgICAgICB0aGlzLnVuaWZvcm1zID0geyB1X1NhbXBsZXI6IG51bGwsIHVfVHJhbnNmb3JtOiBudWxsIH07XG4gICAgICAgIHRoaXMuY29vcmRzID0gbmV3IEZsb2F0MzJBcnJheShbXG4gICAgICAgICAgICAtMSwgMSwgMC4wLCAxLjAsXG4gICAgICAgICAgICAtMSwgLTEsIDAuMCwgMC4wLFxuICAgICAgICAgICAgMSwgMSwgMS4wLCAxLjAsXG4gICAgICAgICAgICAxLCAtMSwgMS4wLCAwLjBcbiAgICAgICAgXSk7XG4gICAgICAgIHRoaXMubiA9IDQ7XG4gICAgICAgIHRoaXMuYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7XG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLmJ1ZmZlcik7XG4gICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLmNvb3JkcywgZ2wuU1RBVElDX0RSQVcpO1xuICAgICAgICBjb25zdCBGU0laRSA9IHRoaXMuY29vcmRzLkJZVEVTX1BFUl9FTEVNRU5UO1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMuYV9Qb3NpdGlvbiA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIEF0dHJpYnV0ZU5hbWVzLmFfUG9zaXRpb24pO1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMuYV9UZXhDb29yZCA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIEF0dHJpYnV0ZU5hbWVzLmFfVGV4Q29vcmQpO1xuICAgICAgICB0aGlzLnVuaWZvcm1zLnVfVHJhbnNmb3JtID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sIFVuaWZvcm1OYW1lcy51X1RyYW5zZm9ybSk7XG4gICAgICAgIHRoaXMudW5pZm9ybXMudV9TYW1wbGVyID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sIFVuaWZvcm1OYW1lcy51X1NhbXBsZXIpO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmF0dHJpYnV0ZXMpO1xuICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHRoaXMuYXR0cmlidXRlcy5hX1Bvc2l0aW9uLCAyLCBnbC5GTE9BVCwgZmFsc2UsIEZTSVpFICogNCwgMCk7XG4gICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHRoaXMuYXR0cmlidXRlcy5hX1Bvc2l0aW9uKTtcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcih0aGlzLmF0dHJpYnV0ZXMuYV9UZXhDb29yZCwgMiwgZ2wuRkxPQVQsIGZhbHNlLCBGU0laRSAqIDQsIEZTSVpFICogMik7XG4gICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHRoaXMuYXR0cmlidXRlcy5hX1RleENvb3JkKTtcbiAgICAgICAgdGhpcy50ZXh0dXJlcy5wdXNoKC4uLnRoaXMuaW5pdFRleHR1cmVzKGdsLCBwcm9ncmFtKSk7XG4gICAgICAgIHRoaXMucHJvZ3JhbSA9IHByb2dyYW07XG4gICAgfVxuICAgIGluaXRUZXh0dXJlcyhnbCwgcHJvZ3JhbSkge1xuICAgICAgICBjb25zdCB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xuICAgICAgICBjb25zdCB0ZXh0dXJlMiA9IGdsLmNyZWF0ZVRleHR1cmUoKTtcbiAgICAgICAgaWYgKHRleHR1cmUgPT0gbnVsbCB8fCB0ZXh0dXJlMiA9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvdWxkbid0IGNyZWF0ZSB3ZWJnbCB0ZXh0dXJlXCIpO1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMudW5pZm9ybXMpO1xuICAgICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB0aGlzLmxvYWRUZXh0dXJlKGdsLCB0ZXh0dXJlLCBpbWFnZSwgZ2wuVEVYVFVSRTAsIDApO1xuICAgICAgICBpbWFnZS5zcmMgPSAnLi9pbWFnZXMvbWFwLmpwZyc7XG4gICAgICAgIGNvbnN0IGltYWdlMiA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBpbWFnZTIub25sb2FkID0gKCkgPT4gdGhpcy5sb2FkVGV4dHVyZShnbCwgdGV4dHVyZTIsIGltYWdlMiwgZ2wuVEVYVFVSRTEsIDEpO1xuICAgICAgICBpbWFnZTIuc3JjID0gJy4vaW1hZ2VzL21hcDIuanBnJztcbiAgICAgICAgcmV0dXJuIFt0ZXh0dXJlLCB0ZXh0dXJlMl07XG4gICAgfVxuICAgIHN3YXBUZXh0dXJlcyhnbCwgdGV4TnVtYmVyKSB7XG4gICAgICAgIHRoaXMudGV4SW5kZXggPSB0ZXhOdW1iZXI7XG4gICAgICAgIGdsLnVzZVByb2dyYW0odGhpcy5wcm9ncmFtKTtcbiAgICAgICAgLy8gZ2wudW5pZm9ybTFpKHRoaXMudW5pZm9ybXMudV9TYW1wbGVyLCB0ZXhOdW1iZXIpO1xuICAgIH1cbiAgICBsb2FkVGV4dHVyZShnbCwgdGV4dHVyZSwgaW1hZ2UsIHRleE51bWJlckVudW0sIHRleE51bWJlcikge1xuICAgICAgICBnbC51c2VQcm9ncmFtKHRoaXMucHJvZ3JhbSk7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIDEpO1xuICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKHRleE51bWJlckVudW0pO1xuICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXh0dXJlKTtcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLkxJTkVBUik7XG4gICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLkNMQU1QX1RPX0VER0UpO1xuICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5DTEFNUF9UT19FREdFKTtcbiAgICAgICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBnbC5SR0IsIGdsLlJHQiwgZ2wuVU5TSUdORURfQllURSwgaW1hZ2UpO1xuICAgICAgICBnbC51bmlmb3JtMWkodGhpcy51bmlmb3Jtcy51X1NhbXBsZXIsIHRleE51bWJlcik7XG4gICAgICAgIGdsLmRyYXdBcnJheXMoZ2wuVFJJQU5HTEVfU1RSSVAsIDAsIHRoaXMubik7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibG9hZGVkXCIpO1xuICAgIH1cbiAgICBkcmF3KGdsLCB0cmFuc2Zvcm0pIHtcbiAgICAgICAgZ2wudXNlUHJvZ3JhbSh0aGlzLnByb2dyYW0pO1xuICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMudW5pZm9ybXMudV9UcmFuc2Zvcm0sIGZhbHNlLCB0cmFuc2Zvcm0pO1xuICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy5idWZmZXIpO1xuICAgICAgICBpZiAodGhpcy5kaXJ0eSlcbiAgICAgICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLmNvb3JkcywgZ2wuU1RBVElDX0RSQVcpO1xuICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0aGlzLnRleHR1cmVzW3RoaXMudGV4SW5kZXhdKTtcbiAgICAgICAgY29uc3QgRlNJWkUgPSB0aGlzLmNvb3Jkcy5CWVRFU19QRVJfRUxFTUVOVDtcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcih0aGlzLmF0dHJpYnV0ZXMuYV9Qb3NpdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCBGU0laRSAqIDQsIDApO1xuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSh0aGlzLmF0dHJpYnV0ZXMuYV9Qb3NpdGlvbik7XG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIodGhpcy5hdHRyaWJ1dGVzLmFfVGV4Q29vcmQsIDIsIGdsLkZMT0FULCBmYWxzZSwgRlNJWkUgKiA0LCBGU0laRSAqIDIpO1xuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSh0aGlzLmF0dHJpYnV0ZXMuYV9UZXhDb29yZCk7XG4gICAgICAgIGdsLmRyYXdBcnJheXMoZ2wuVFJJQU5HTEVfU1RSSVAsIDAsIHRoaXMubik7XG4gICAgfVxuICAgIGRpbGF0ZShjYW52YXMsIHgsIHksIGFtb3VudCkge1xuICAgICAgICBsZXQgaW5DYW52YXMgPSBnbFBvc0Zyb21DbGllbnQoY2FudmFzLCB4LCB5KTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNvb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5jb29yZHMubGVuZ3RoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGkpO1xuICAgICAgICAgICAgbGV0IHRleCA9IHsgeDogdGhpcy5jb29yZHNbaSAqIDRdLCB5OiB0aGlzLmNvb3Jkc1tpICogNCArIDFdIH07XG4gICAgICAgICAgICB0ZXggPSBzdWJ0cmFjdCh0ZXgsIGluQ2FudmFzKTtcbiAgICAgICAgICAgIHRleC54ICo9IGFtb3VudDtcbiAgICAgICAgICAgIHRleC55ICo9IGFtb3VudDtcbiAgICAgICAgICAgIHRleCA9IGFkZCh0ZXgsIGluQ2FudmFzKTtcbiAgICAgICAgICAgIHRoaXMuY29vcmRzW2kgKiA0XSA9IHRleC54O1xuICAgICAgICAgICAgdGhpcy5jb29yZHNbaSAqIDQgKyAxXSA9IHRleC55O1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuY29vcmRzKTtcbiAgICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgfVxufVxuZXhwb3J0IGRlZmF1bHQgVGV4dHVyZTtcbiIsImltcG9ydCBmSGVsbG9Qb2ludCBmcm9tICcuL3NoYWRlcnMvZkhlbGxvUG9pbnQuZ2xzbCc7XG5pbXBvcnQgdkhlbGxvUG9pbnQgZnJvbSAnLi9zaGFkZXJzL3ZIZWxsb1BvaW50Lmdsc2wnO1xuaW1wb3J0IHZUZXh0dXJlIGZyb20gJy4vc2hhZGVycy92VGV4dHVyZWQuZ2xzbCc7XG5pbXBvcnQgZlRleHR1cmUgZnJvbSAnLi9zaGFkZXJzL2ZUZXh0dXJlZC5nbHNsJztcbmltcG9ydCBEcmF3aW5nIGZyb20gXCIuL2RyYXdpbmdcIjtcbmltcG9ydCBzZXR1cEhhbmRsZXJzIGZyb20gXCIuL2hhbmRsZXJzXCI7XG5pbXBvcnQgVGV4dHVyZSBmcm9tIFwiLi90ZXh0dXJlXCI7XG5mdW5jdGlvbiBtYWluKCkge1xuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICBjYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XG4gICAgY29uc3QgZ2wgPSBjYW52YXMuZ2V0Q29udGV4dChcIndlYmdsXCIpO1xuICAgIGlmICghZ2wpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJubyB3ZWJnbCBjb250ZXh0IGF2YWlsYWJsZVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBnbC5jbGVhckNvbG9yKDAuMCwgMC4wLCAwLjAsIDEuMCk7XG4gICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7XG4gICAgY29uc3QgdGV4dHVyZSA9IGluaXRpYWxpemVUZXh0dXJlKGNhbnZhcywgZ2wpO1xuICAgIGNvbnN0IGRyYXdpbmcgPSBpbml0aWFsaXplRHJhd2luZyhjYW52YXMsIGdsKTtcbiAgICBpZiAodGV4dHVyZSA9PSBudWxsIHx8IGRyYXdpbmcgPT0gbnVsbCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImZhaWxlZCB0byBpbml0aWFsaXplIG9iamVjdHNcIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2V0dXBIYW5kbGVycyhjYW52YXMsIGdsLCBkcmF3aW5nLCB0ZXh0dXJlKTtcbiAgICBjb25zdCByZW5kZXIgPSAoKSA9PiB7XG4gICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpO1xuICAgICAgICB0ZXh0dXJlID09PSBudWxsIHx8IHRleHR1cmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRleHR1cmUuZHJhdyhnbCwgZHJhd2luZy50cmFuc2Zvcm0pO1xuICAgICAgICBkcmF3aW5nID09PSBudWxsIHx8IGRyYXdpbmcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRyYXdpbmcucmVuZGVyQnVmZmVyKGdsKTtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG4gICAgfTtcbiAgICByZW5kZXIoKTtcbn1cbmZ1bmN0aW9uIGluaXRpYWxpemVUZXh0dXJlKGNhbnZhcywgZ2wpIHtcbiAgICBjb25zdCBwcm9ncmFtID0gaW5pdFNoYWRlcnMoZ2wsIHZUZXh0dXJlLCBmVGV4dHVyZSk7XG4gICAgaWYgKHByb2dyYW0gPT0gbnVsbCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImZhaWxlZCB0byBpbml0aWFsaXplIHNoYWRlcnNcIik7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFRleHR1cmUoZ2wsIHByb2dyYW0pO1xufVxuZnVuY3Rpb24gaW5pdGlhbGl6ZURyYXdpbmcoY2FudmFzLCBnbCkge1xuICAgIGNvbnN0IHByb2dyYW0gPSBpbml0U2hhZGVycyhnbCwgdkhlbGxvUG9pbnQsIGZIZWxsb1BvaW50KTtcbiAgICBpZiAocHJvZ3JhbSA9PSBudWxsKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZmFpbGVkIHRvIGluaXRpYWxpemUgc2hhZGVyc1wiKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGRyYXdpbmcgPSBuZXcgRHJhd2luZyhwcm9ncmFtKTtcbiAgICBjb25zdCBhX1Bvc2l0aW9uID0gZ2wuZ2V0QXR0cmliTG9jYXRpb24ocHJvZ3JhbSwgJ2FfUG9zaXRpb24nKTtcbiAgICBpZiAoYV9Qb3NpdGlvbiA8IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJmYWlsZWQgdG8gZ2V0IHRoZSBzdG9yYWdlIGxvY2F0aW9uIG9mIGFfUG9zaXRpb25cIik7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBhX1BvaW50U2l6ZSA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sICdhX1BvaW50U2l6ZScpO1xuICAgIGlmIChhX1BvaW50U2l6ZSA8IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJmYWlsZWQgdG8gZ2V0IHRoZSBzdG9yYWdlIGxvY2F0aW9uIG9mIGFfUG9pbnRTaXplXCIpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgdV9GcmFnQ29sb3IgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgJ3VfRnJhZ0NvbG9yJyk7XG4gICAgaWYgKHVfRnJhZ0NvbG9yID09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJmYWlsZWQgdG8gZ2V0IHVuaWZvcm0gdV9mcmFnQ29sb3JcIik7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBkcmF3aW5nLmF0dHJpYnV0ZXMuYV9Qb3NpdGlvbiA9IGFfUG9zaXRpb247XG4gICAgZHJhd2luZy5hdHRyaWJ1dGVzLnVfRnJhZ0NvbG9yID0gdV9GcmFnQ29sb3I7XG4gICAgZHJhd2luZy5hdHRyaWJ1dGVzLmFfUG9pbnRTaXplID0gYV9Qb2ludFNpemU7XG4gICAgZ2wudmVydGV4QXR0cmliMWYoYV9Qb2ludFNpemUsIDIwLjApO1xuICAgIGRyYXdpbmcuc2V0VHJhbnNmb3JtVW5pZm9ybShnbCwgcHJvZ3JhbSk7XG4gICAgY29uc3QgbiA9IGRyYXdpbmcuaW5pdFZlcnRleEJ1ZmZlcnMoZ2wsIHByb2dyYW0pO1xuICAgIGdsLmRyYXdBcnJheXMoZ2wuUE9JTlRTLCAwLCBuKTtcbiAgICByZXR1cm4gZHJhd2luZztcbn1cbmZ1bmN0aW9uIGluaXRTaGFkZXJzKGdsLCB2U2hhZGVyLCBmU2hhZGVyKSB7XG4gICAgY29uc3QgcHJvZ3JhbSA9IGNyZWF0ZVByb2dyYW0oZ2wsIHZTaGFkZXIsIGZTaGFkZXIpO1xuICAgIGlmICghcHJvZ3JhbSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkZhaWxlZCB0byBjcmVhdGUgcHJvZ3JhbVwiKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGdsLnVzZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgcmV0dXJuIHByb2dyYW07XG59XG5mdW5jdGlvbiBjcmVhdGVQcm9ncmFtKGdsLCB2U2hhZGVyLCBmU2hhZGVyKSB7XG4gICAgY29uc3QgdmVydGV4U2hhZGVyID0gbG9hZFNoYWRlcihnbCwgZ2wuVkVSVEVYX1NIQURFUiwgdlNoYWRlcik7XG4gICAgY29uc3QgZnJhZ21lbnRTaGFkZXIgPSBsb2FkU2hhZGVyKGdsLCBnbC5GUkFHTUVOVF9TSEFERVIsIGZTaGFkZXIpO1xuICAgIGlmICghdmVydGV4U2hhZGVyIHx8ICFmcmFnbWVudFNoYWRlcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgcHJvZ3JhbSA9IGdsLmNyZWF0ZVByb2dyYW0oKTtcbiAgICBpZiAoIXByb2dyYW0pIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2ZXJ0ZXhTaGFkZXIpO1xuICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCBmcmFnbWVudFNoYWRlcik7XG4gICAgZ2wubGlua1Byb2dyYW0ocHJvZ3JhbSk7XG4gICAgY29uc3QgbGlua2VkID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCBnbC5MSU5LX1NUQVRVUyk7XG4gICAgaWYgKCFsaW5rZWQpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBnbC5nZXRQcm9ncmFtSW5mb0xvZyhwcm9ncmFtKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJGYWlsZWQgdG8gbGluayBwcm9ncmFtLCByZWFzb246IFwiICsgZXJyb3IpO1xuICAgICAgICBnbC5kZWxldGVQcm9ncmFtKHByb2dyYW0pO1xuICAgICAgICBnbC5kZWxldGVTaGFkZXIoZnJhZ21lbnRTaGFkZXIpO1xuICAgICAgICBnbC5kZWxldGVTaGFkZXIodmVydGV4U2hhZGVyKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBwcm9ncmFtO1xufVxuZnVuY3Rpb24gbG9hZFNoYWRlcihnbCwgdHlwZSwgc291cmNlKSB7XG4gICAgY29uc3Qgc2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKHR5cGUpO1xuICAgIGlmIChzaGFkZXIgPT0gbnVsbCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImZhaWxlZCB0byBjcmVhdGUgc2hhZGVyXCIpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgZ2wuc2hhZGVyU291cmNlKHNoYWRlciwgc291cmNlKTtcbiAgICBnbC5jb21waWxlU2hhZGVyKHNoYWRlcik7XG4gICAgY29uc3QgY29tcGlsZWQgPSBnbC5nZXRTaGFkZXJQYXJhbWV0ZXIoc2hhZGVyLCBnbC5DT01QSUxFX1NUQVRVUyk7XG4gICAgaWYgKCFjb21waWxlZCkge1xuICAgICAgICBjb25zdCBlcnJvciA9IGdsLmdldFNoYWRlckluZm9Mb2coc2hhZGVyKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJGYWlsZWQgdG8gY29tcGlsZSBzaGFkZXIsIHJlYXNvbjogXCIgKyBlcnJvcik7XG4gICAgICAgIGdsLmRlbGV0ZVNoYWRlcihzaGFkZXIpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHNoYWRlcjtcbn1cbm1haW4oKTtcbiIsImV4cG9ydCBkZWZhdWx0IFwiI3ZlcnNpb24gMTAwXFxuXFxuYXR0cmlidXRlIHZlYzQgYV9Qb3NpdGlvbjtcXG5hdHRyaWJ1dGUgdmVjMiBhX1RleENvb3JkO1xcbnVuaWZvcm0gbWF0NCB1X1RyYW5zZm9ybTtcXG52YXJ5aW5nIHZlYzIgdl9UZXhDb29yZDtcXG52b2lkIG1haW4oKSB7XFxuICAgIGdsX1Bvc2l0aW9uID0gdV9UcmFuc2Zvcm0gKiBhX1Bvc2l0aW9uO1xcbiAgICB2X1RleENvb3JkID0gYV9UZXhDb29yZDtcXG59XCIiLCJleHBvcnQgZGVmYXVsdCBcIiN2ZXJzaW9uIDEwMFxcblxcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xcbnVuaWZvcm0gc2FtcGxlcjJEIHVfU2FtcGxlcjtcXG52YXJ5aW5nIHZlYzIgdl9UZXhDb29yZDtcXG52b2lkIG1haW4oKSB7XFxuICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCh1X1NhbXBsZXIsIHZfVGV4Q29vcmQpO1xcbn1cIiIsImV4cG9ydCBkZWZhdWx0IFwiYXR0cmlidXRlIHZlYzQgYV9Qb3NpdGlvbjtcXG5hdHRyaWJ1dGUgZmxvYXQgYV9Qb2ludFNpemU7XFxudW5pZm9ybSBtYXQ0IHVfVHJhbnNmb3JtO1xcbnZvaWQgbWFpbigpIHtcXG4gICAgZ2xfUG9zaXRpb24gPSB1X1RyYW5zZm9ybSAqIGFfUG9zaXRpb247XFxuICAgIGdsX1BvaW50U2l6ZSA9IGFfUG9pbnRTaXplO1xcbn1cIiIsImV4cG9ydCBkZWZhdWx0IFwicHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7XFxuXFxudW5pZm9ybSB2ZWM0IHVfRnJhZ0NvbG9yO1xcbnZvaWQgbWFpbigpIHtcXG4gICAgZ2xfRnJhZ0NvbG9yID0gdV9GcmFnQ29sb3I7XFxufVwiIiwiaW1wb3J0IHsgZ2xQb3NGcm9tQ2xpZW50LCB1bnBhY2sgfSBmcm9tIFwiLi93ZWJnbF91dGlsc1wiO1xuaW1wb3J0IHsgYWRkLCBtdWx0LCBzdWJ0cmFjdCB9IGZyb20gXCIuL2ludGVyZmFjZXNcIjtcbmNsYXNzIERyYXdpbmcge1xuICAgIGNvbnN0cnVjdG9yKHByb2dyYW0pIHtcbiAgICAgICAgdGhpcy50cmFuc2Zvcm0gPSBuZXcgRmxvYXQzMkFycmF5KCk7XG4gICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5nbF9Qb2ludHMgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgdGhpcy5nbF9Db2xvcnMgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgdGhpcy5zaGFwZUluZGljZXMgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgdGhpcy5zaGFwZUluZGljZXMucHVzaCgwKTtcbiAgICAgICAgdGhpcy5zaGFwZUluZGljZXMucHVzaCgwKTtcbiAgICAgICAgdGhpcy5hbmdsZSA9IDAuMDtcbiAgICAgICAgdGhpcy50cmFuc2xhdGlvbiA9IHsgeDogMCwgeTogMCB9O1xuICAgICAgICB0aGlzLnRyYW5zbGF0aW9uU2NhbGUgPSAwLjAwNTtcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0geyBhX1Bvc2l0aW9uOiAtMSwgdV9GcmFnQ29sb3I6IG51bGwsIGFfUG9pbnRTaXplOiAtMSB9O1xuICAgICAgICB0aGlzLnByb2dyYW0gPSBwcm9ncmFtO1xuICAgICAgICB0aGlzLnZlcnRleEJ1ZmZlciA9IG51bGw7XG4gICAgfVxuICAgIGNsaWNrKGV2ZW50LCBnbCwgY2FudmFzKSB7XG4gICAgICAgIGxldCB4ID0gZXZlbnQuY2xpZW50WDtcbiAgICAgICAgbGV0IHkgPSBldmVudC5jbGllbnRZO1xuICAgICAgICBsZXQgZ2xQb3MgPSBnbFBvc0Zyb21DbGllbnQoY2FudmFzLCB4LCB5KTtcbiAgICAgICAgLy8gZ2xQb3MgPSBzdWJ0cmFjdChnbFBvcywgdGhpcy50cmFuc2xhdGlvbik7XG4gICAgICAgIGdsUG9zID0gdGhpcy5nZXRJbnYoZ2xQb3MpO1xuICAgICAgICB0aGlzLmdsX1BvaW50cy5wdXNoKG5ldyBBcnJheSguLi5bZ2xQb3MueCwgZ2xQb3MueSwgMF0pKTtcbiAgICAgICAgY29uc3Qgbm9ybSA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5KTtcbiAgICAgICAgdGhpcy5nbF9Db2xvcnMucHVzaChuZXcgQXJyYXkoLi4uW25vcm0sIDEgLSBub3JtLCBub3JtLCAxXSkpO1xuICAgICAgICB0aGlzLnJlbmRlckJ1ZmZlcihnbCk7XG4gICAgfVxuICAgIHJlbmRlckJ1ZmZlcihnbCkge1xuICAgICAgICAvLyBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTtcbiAgICAgICAgZ2wudXNlUHJvZ3JhbSh0aGlzLnByb2dyYW0pO1xuICAgICAgICBpZiAodGhpcy5kaXJ0eSlcbiAgICAgICAgICAgIHRoaXMuc2V0VHJhbnNmb3JtVW5pZm9ybShnbCwgdGhpcy5wcm9ncmFtKTtcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHRoaXMudmVydGV4QnVmZmVyKTtcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcih0aGlzLmF0dHJpYnV0ZXMuYV9Qb3NpdGlvbiwgMywgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkodGhpcy5hdHRyaWJ1dGVzLmFfUG9zaXRpb24pO1xuICAgICAgICBnbC5saW5lV2lkdGgoNSk7XG4gICAgICAgIHRoaXMuc2V0QnVmZmVyKGdsKTtcbiAgICAgICAgY29uc3Qgc2hhcGVJbmRpY2VzID0gdGhpcy5zaGFwZUluZGljZXM7XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc2hhcGVJbmRpY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBnbC5kcmF3QXJyYXlzKGdsLkxJTkVfU1RSSVAsIHNoYXBlSW5kaWNlc1tpIC0gMV0sIHNoYXBlSW5kaWNlc1tpXSAtIHNoYXBlSW5kaWNlc1tpIC0gMV0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldEJ1ZmZlcihnbCkge1xuICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdW5wYWNrKHRoaXMuZ2xfUG9pbnRzKSwgZ2wuU1RBVElDX0RSQVcpO1xuICAgIH1cbiAgICB0cmFuc2Zvcm1BbmRSZW5kZXIoZ2wsIHByb2dyYW0pIHtcbiAgICAgICAgdGhpcy5zZXRUcmFuc2Zvcm1Vbmlmb3JtKGdsLCBwcm9ncmFtKTtcbiAgICAgICAgdGhpcy5yZW5kZXJCdWZmZXIoZ2wpO1xuICAgIH1cbiAgICBzZXRUcmFuc2Zvcm1Vbmlmb3JtKGdsLCBwcm9ncmFtKSB7XG4gICAgICAgIGNvbnN0IHVfVHJhbnNmb3JtID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICd1X1RyYW5zZm9ybScpO1xuICAgICAgICBpZiAodV9UcmFuc2Zvcm0gPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb3VsZG4ndCBzZXQgdW5pZm9ybXMgZm9yIHRyYW5zZm9ybWF0aW9uc1wiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbih0aGlzLmFuZ2xlKTtcbiAgICAgICAgY29uc3QgY29zID0gTWF0aC5jb3ModGhpcy5hbmdsZSk7XG4gICAgICAgIHRoaXMudHJhbnNmb3JtID0gbmV3IEZsb2F0MzJBcnJheShbXG4gICAgICAgICAgICBjb3MsIHNpbiwgMCwgMCxcbiAgICAgICAgICAgIC1zaW4sIGNvcywgMCwgMCxcbiAgICAgICAgICAgIDAsIDAsIDEsIDAsXG4gICAgICAgICAgICB0aGlzLnRyYW5zbGF0aW9uLngsIHRoaXMudHJhbnNsYXRpb24ueSwgMCwgMSxcbiAgICAgICAgXSk7XG4gICAgICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodV9UcmFuc2Zvcm0sIGZhbHNlLCB0aGlzLnRyYW5zZm9ybSk7XG4gICAgfVxuICAgIGdldEludih2KSB7XG4gICAgICAgIGNvbnN0IHNpbiA9IE1hdGguc2luKC10aGlzLmFuZ2xlKTtcbiAgICAgICAgY29uc3QgY29zID0gTWF0aC5jb3MoLXRoaXMuYW5nbGUpO1xuICAgICAgICBjb25zdCBpbnZUcmFuc2Zvcm0gPSBuZXcgRmxvYXQzMkFycmF5KFtcbiAgICAgICAgICAgIGNvcywgc2luLCAwLCAwLFxuICAgICAgICAgICAgLXNpbiwgY29zLCAwLCAwLFxuICAgICAgICAgICAgMCwgMCwgMSwgMCxcbiAgICAgICAgICAgIC10aGlzLnRyYW5zbGF0aW9uLngsIC10aGlzLnRyYW5zbGF0aW9uLnksIDAsIDEsXG4gICAgICAgIF0pO1xuICAgICAgICByZXR1cm4gbXVsdChpbnZUcmFuc2Zvcm0sIHYpO1xuICAgIH1cbiAgICBkaWxhdGUoY2FudmFzLCB4LCB5LCBhbW91bnQpIHtcbiAgICAgICAgbGV0IGluQ2FudmFzID0gZ2xQb3NGcm9tQ2xpZW50KGNhbnZhcywgeCwgeSk7XG4gICAgICAgIGxldCBnbF9Qb2ludHMgPSB0aGlzLmdsX1BvaW50cztcbiAgICAgICAgaW5DYW52YXMgPSBzdWJ0cmFjdChpbkNhbnZhcywgdGhpcy50cmFuc2xhdGlvbik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ2xfUG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgdiA9IGdsX1BvaW50c1tpXTtcbiAgICAgICAgICAgIGxldCB2ZWMgPSB7IHg6IHZbMF0sIHk6IHZbMV0gfTtcbiAgICAgICAgICAgIHZlYyA9IHN1YnRyYWN0KHZlYywgaW5DYW52YXMpO1xuICAgICAgICAgICAgdmVjLnggKj0gYW1vdW50O1xuICAgICAgICAgICAgdmVjLnkgKj0gYW1vdW50O1xuICAgICAgICAgICAgdmVjID0gYWRkKHZlYywgaW5DYW52YXMpO1xuICAgICAgICAgICAgZ2xfUG9pbnRzW2ldWzBdID0gdmVjLng7XG4gICAgICAgICAgICBnbF9Qb2ludHNbaV1bMV0gPSB2ZWMueTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpbml0VmVydGV4QnVmZmVycyhnbCwgcHJvZ3JhbSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5nbF9Qb2ludHMubGVuZ3RoIC8gMjtcbiAgICAgICAgdGhpcy52ZXJ0ZXhCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcbiAgICAgICAgaWYgKCF0aGlzLnZlcnRleEJ1ZmZlcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJmYWlsZWQgdG8gY3JlYXRlIGJ1ZmZlclwiKTtcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy52ZXJ0ZXhCdWZmZXIpO1xuICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdW5wYWNrKHRoaXMuZ2xfUG9pbnRzKSwgZ2wuU1RBVElDX0RSQVcpO1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMuYV9Qb3NpdGlvbiA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sICdhX1Bvc2l0aW9uJyk7XG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIodGhpcy5hdHRyaWJ1dGVzLmFfUG9zaXRpb24sIDMsIGdsLkZMT0FULCBmYWxzZSwgMCwgMCk7XG4gICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHRoaXMuYXR0cmlidXRlcy5hX1Bvc2l0aW9uKTtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxufVxuZXhwb3J0IGRlZmF1bHQgRHJhd2luZztcbiJdLCJuYW1lcyI6WyJnbFBvc0Zyb21DbGllbnQiLCJjYW52YXMiLCJ4IiwieSIsInJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJsZWZ0Iiwid2lkdGgiLCJoZWlnaHQiLCJ0b3AiLCJ1bnBhY2siLCJhcnJheSIsIm91dCIsIkZsb2F0MzJBcnJheSIsImxlbmd0aCIsImkiLCJhZGQiLCJ2MSIsInYyIiwic3VidHJhY3QiLCJsZWZ0TW91c2VEb3duIiwicmlnaHRNb3VzZURvd24iLCJVbmlmb3JtTmFtZXMiLCJBdHRyaWJ1dGVOYW1lcyIsImluaXRpYWxpemVUZXh0dXJlIiwiZ2wiLCJwcm9ncmFtIiwiaW5pdFNoYWRlcnMiLCJjb25zb2xlIiwibG9nIiwiY29uc3RydWN0b3IiLCJ0aGlzIiwidGV4dHVyZXMiLCJBcnJheSIsImRpcnR5IiwidHJhbnNmb3JtIiwidGV4SW5kZXgiLCJhdHRyaWJ1dGVzIiwiYV9Qb3NpdGlvbiIsImFfVGV4Q29vcmQiLCJ1bmlmb3JtcyIsInVfU2FtcGxlciIsInVfVHJhbnNmb3JtIiwiY29vcmRzIiwibiIsImJ1ZmZlciIsImNyZWF0ZUJ1ZmZlciIsImJpbmRCdWZmZXIiLCJBUlJBWV9CVUZGRVIiLCJidWZmZXJEYXRhIiwiU1RBVElDX0RSQVciLCJGU0laRSIsIkJZVEVTX1BFUl9FTEVNRU5UIiwiZ2V0QXR0cmliTG9jYXRpb24iLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJ2ZXJ0ZXhBdHRyaWJQb2ludGVyIiwiRkxPQVQiLCJlbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSIsInB1c2giLCJpbml0VGV4dHVyZXMiLCJ0ZXh0dXJlIiwiY3JlYXRlVGV4dHVyZSIsInRleHR1cmUyIiwiaW1hZ2UiLCJJbWFnZSIsIm9ubG9hZCIsImxvYWRUZXh0dXJlIiwiVEVYVFVSRTAiLCJzcmMiLCJpbWFnZTIiLCJURVhUVVJFMSIsInN3YXBUZXh0dXJlcyIsInRleE51bWJlciIsInVzZVByb2dyYW0iLCJ0ZXhOdW1iZXJFbnVtIiwicGl4ZWxTdG9yZWkiLCJVTlBBQ0tfRkxJUF9ZX1dFQkdMIiwiYWN0aXZlVGV4dHVyZSIsImJpbmRUZXh0dXJlIiwiVEVYVFVSRV8yRCIsInRleFBhcmFtZXRlcmkiLCJURVhUVVJFX01JTl9GSUxURVIiLCJMSU5FQVIiLCJURVhUVVJFX1dSQVBfUyIsIkNMQU1QX1RPX0VER0UiLCJURVhUVVJFX1dSQVBfVCIsInRleEltYWdlMkQiLCJSR0IiLCJVTlNJR05FRF9CWVRFIiwidW5pZm9ybTFpIiwiZHJhd0FycmF5cyIsIlRSSUFOR0xFX1NUUklQIiwiZHJhdyIsInVuaWZvcm1NYXRyaXg0ZnYiLCJkaWxhdGUiLCJhbW91bnQiLCJpbkNhbnZhcyIsInRleCIsInZTaGFkZXIiLCJmU2hhZGVyIiwidmVydGV4U2hhZGVyIiwibG9hZFNoYWRlciIsIlZFUlRFWF9TSEFERVIiLCJmcmFnbWVudFNoYWRlciIsIkZSQUdNRU5UX1NIQURFUiIsImNyZWF0ZVByb2dyYW0iLCJhdHRhY2hTaGFkZXIiLCJsaW5rUHJvZ3JhbSIsImdldFByb2dyYW1QYXJhbWV0ZXIiLCJMSU5LX1NUQVRVUyIsImVycm9yIiwiZ2V0UHJvZ3JhbUluZm9Mb2ciLCJkZWxldGVQcm9ncmFtIiwiZGVsZXRlU2hhZGVyIiwidHlwZSIsInNvdXJjZSIsInNoYWRlciIsImNyZWF0ZVNoYWRlciIsInNoYWRlclNvdXJjZSIsImNvbXBpbGVTaGFkZXIiLCJnZXRTaGFkZXJQYXJhbWV0ZXIiLCJDT01QSUxFX1NUQVRVUyIsImdldFNoYWRlckluZm9Mb2ciLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsImlubmVyV2lkdGgiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJnZXRDb250ZXh0IiwiY2xlYXJDb2xvciIsImNsZWFyIiwiQ09MT1JfQlVGRkVSX0JJVCIsImRyYXdpbmciLCJnbF9Qb2ludHMiLCJnbF9Db2xvcnMiLCJzaGFwZUluZGljZXMiLCJhbmdsZSIsInRyYW5zbGF0aW9uIiwidHJhbnNsYXRpb25TY2FsZSIsInVfRnJhZ0NvbG9yIiwiYV9Qb2ludFNpemUiLCJ2ZXJ0ZXhCdWZmZXIiLCJjbGljayIsImV2ZW50IiwiY2xpZW50WCIsImNsaWVudFkiLCJnbFBvcyIsImdldEludiIsIm5vcm0iLCJNYXRoIiwic3FydCIsInJlbmRlckJ1ZmZlciIsInNldFRyYW5zZm9ybVVuaWZvcm0iLCJsaW5lV2lkdGgiLCJzZXRCdWZmZXIiLCJMSU5FX1NUUklQIiwidHJhbnNmb3JtQW5kUmVuZGVyIiwic2luIiwiY29zIiwidiIsIm1hdCIsIm11bHQiLCJ2ZWMiLCJpbml0VmVydGV4QnVmZmVycyIsInZlcnRleEF0dHJpYjFmIiwiUE9JTlRTIiwiaW5pdGlhbGl6ZURyYXdpbmciLCJjaGFuZ2VSb3RhdGlvbiIsInZhbHVlIiwib25tb3VzZWRvd24iLCJidXR0b24iLCJvbmNvbnRleHRtZW51IiwicHJldmVudERlZmF1bHQiLCJvbm1vdXNldXAiLCJvbm1vdXNlbW92ZSIsImRlbHRhWCIsIm1vdmVtZW50WCIsImRlbHRhWSIsIm1vdmVtZW50WSIsIm9ua2V5ZG93biIsImNvZGUiLCJvbndoZWVsIiwiZGlsYXRpb24iLCJyZW5kZXIiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtYWluIl0sInNvdXJjZVJvb3QiOiIifQ==